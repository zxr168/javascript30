<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Type Ahead ğŸ‘€</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <form class="search-form">
            <input type="text" class="search" placeholder="å”è¯—åç§°ã€è¯—å¥ã€ä½œè€…" />
            <ul class="suggestions">
                <li>å”è¯—ç­›é€‰</li>
                <li>æ ¹æ®è¯å¥ã€ä½œè€…ã€åç§°ç­›é€‰</li>
                <li></li>
            </ul>
        </form>
        <script>
            const endpoint = 'https://gist.githubusercontent.com/soyaine/81399bb2b24ca1bb5313e1985533c640/raw/bdf7df2cbcf70706c4a5e51a7dfb8c933ed78878/TangPoetry.json'
            // const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json'
            
            const tangPoetryList = []

            fetch(endpoint)
                .then(response => response.json())
                .then(data => {
                    console.log(data)
                    tangPoetryList.push(...data)
                })
            
            function findData(value, tangPoetryList) {
                const regex = new RegExp(value, 'gi')
                return tangPoetryList.filter(poet => {
                    // ä½œè€…æ˜¯æ•°ç»„ï¼Œè½¬å˜æˆå­—ç¬¦ä¸²
                    const author = poet.detail_author.join('')

                    return poet.detail_text.match(regex) || poet.title.match(regex) || author.match(regex)
                })
            }

            function changeShow (){
                if(this.value !== ''){
                    // valueä¸ä¸ºç©ºï¼Œè¿›è¡Œç­›é€‰
                    const screenData = findData(this.value, tangPoetryList)
                    const regex = new RegExp(this.value, 'gi')
                    const htmlData = screenData.map(poet => {
                        // æ›¿æ¢é«˜äº®çš„æ ‡ç­¾
                        const text = poet.detail_text.replace(regex, `<span class="hl">${ this.value }</span>`);
                        const title = poet.title.replace(regex, `<span class="hl">${ this.value }</span>`)

                        // æ„é€  HTML å€¼
                        return `
                            <li>
                                <span class="poet">${ text }</span>
                                <span class="title">${ title } - ${ poet.detail_author[0] }</span>
                            </li>
                        `;
                    }).join('');
                    suggestions.innerHTML = htmlData;
                } else{
                    // valueä¸ºç©ºï¼Œä¸è¿›è¡Œç­›é€‰
                    suggestions.innerHTML = '<li>è¾“å…¥è¯å¥ï¼Œæ‰¾ä¸€é¦–è¯—</li><li></li>'
                }
            }

            const oInput = document.querySelector('.search')
            const suggestions = document.querySelector('.suggestions')

            oInput.addEventListener('change', changeShow)
            oInput.addEventListener('keyup', changeShow)
        </script>
    </body>
</html>
